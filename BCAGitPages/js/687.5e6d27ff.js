(self["webpackChunkbrain_web"]=self["webpackChunkbrain_web"]||[]).push([[687],{7996:function(e){e.exports={heatmapData:[{z:[[-.561,-.54,-.486,-.721,-.847,-.662,-.716,-.731,-.453,-.721,.341,-.687,7.979,1.568,.032,.795,-.117,.379,-.404,.028,-.138,-.262,-.715,-.679,-.431,-.634,-.418,-.628],[-.588,-.375,-.538,-.73,-.628,-.661,-.63,-.808,-.471,-.683,.231,-.894,7.968,1.363,-.101,.547,.095,.447,-.413,.075,-.219,-.172,-.723,-.647,-.551,-.631,-.331,-.598],[-.369,2.412,-.533,-.724,-.267,-.62,-.856,-.634,-.732,-.713,-.487,-.671,-.598,-.568,-.288,-.715,-.716,-.76,-.484,.28,-.396,-.516,-.707,-.64,-.694,-.645,-.69,5.362],[-.38,1.535,-.528,-.681,-.542,-.647,-.749,-.561,-.685,-.734,-.586,-.611,-.564,-.553,-.224,-.708,-.698,-.739,-.462,.329,-.385,-.45,-.699,-.638,-.614,-.662,-.657,5.003],[10.503,1.47,-.821,-1.083,-2.025,-1.011,-.986,-1.196,-1.102,-1.176,-1.03,-1.073,-.832,1.837,-.637,-.902,-.976,-.972,-.661,2.93,-.604,-.595,-1.15,-1.091,-1.028,-.982,-1.003,-.784],[10.697,2.952,-.806,-1.01,-1.227,-.967,-1.024,-1.233,-1.08,-1.129,-1.003,-1.023,-.522,1.192,-.613,-.918,-.973,-.948,-.54,2.609,-.842,-.204,-1.102,-1.008,-1.1,-1.027,-.995,-.636],[-.546,2.094,10.237,-.612,-1.254,-.599,-.501,-.621,-.623,-.677,-.616,-.624,-.593,.678,-.475,-.503,-.558,-.561,-.415,1.399,-.783,-.228,-.682,-.668,-.61,-.6,-.537,-.562],[-.514,4.025,11.118,-.539,-.738,-.596,-.514,-.703,-.607,-.635,-.592,-.664,-.575,1.084,-.514,-.499,-.559,-.561,-.406,1.759,-.648,-.118,-.62,-.6,-.628,-.563,-.577,-.519]],x:["cluster8","cluster26","cluster11","cluster2","cluster12","cluster17","cluster19","cluster20","cluster6","cluster9","cluster18","cluster23","cluster14","cluster21","cluster22","cluster0","cluster5","cluster7","cluster15","cluster27","cluster24","cluster25","cluster1","cluster4","cluster10","cluster13","cluster16","cluster3"],y:["human-LAMP5","mouse-LAMP5","human-PVALB","mouse-PVALB","human-SST","mouse-SST","human-VIP","mouse-VIP"],type:"heatmap",colorscale:[[0,"#330066"],[.25,"#336699"],[.5,"#66CC66"],[1,"#FFCC33"]],hoverongaps:!1,hovertemplate:"Cluster: %{x}<br>Gene: %{y}<br>Mean: %{z}",name:"human & mouse"}],textColor:['<span style="color:#CDD796">C8(Inh_SST)</span>','<span style="color:#CDD796">C26(Inh_SST)</span>','<span style="color:#C4AFD2">C11(Inh_VIP)</span>','<span style="color:#FDDD8D">C2(Exc_FEZF2)</span>','<span style="color:#FDDD8D">C12(Exc_FEZF2)</span>','<span style="color:#FDDD8D">C17(Exc_FEZF2)</span>','<span style="color:#FDDD8D">C19(Exc_FEZF2)</span>','<span style="color:#FDDD8D">C20(Exc_FEZF2)</span>','<span style="color:#FEF4C9">C6(Exc_THEMIS)</span>','<span style="color:#FEF4C9">C9(Exc_THEMIS)</span>','<span style="color:#FEF4C9">C18(Exc_THEMIS)</span>','<span style="color:#FEF4C9">C23(Exc_THEMIS)</span>','<span style="color:#9DBFA2">C14(Inh_LAMP5)</span>','<span style="color:#9DBFA2">C21(Inh_LAMP5)</span>','<span style="color:#C2ABC0">C22(Nnc_Astro)</span>','<span style="color:#E3CDDA">C0(Exc_LAMP5)</span>','<span style="color:#E3CDDA">C5(Exc_LAMP5)</span>','<span style="color:#E3CDDA">C7(Exc_LAMP5)</span>','<span style="color:#9189A5">C15(Nnc_Oligo)</span>','<span style="color:#9189A5">C27(Nnc_Oligo)</span>','<span style="color:#98B994">C24(Nnc_Micro)</span>','<span style="color:#CEAABD">C25(Nnc_OPC)</span>','<span style="color:#B0CAC7">C1(Exc_RORB)</span>','<span style="color:#B0CAC7">C4(Exc_RORB)</span>','<span style="color:#B0CAC7">C10(Exc_RORB)</span>','<span style="color:#B0CAC7">C13(Exc_RORB)</span>','<span style="color:#B0CAC7">C16(Exc_RORB)</span>','<span style="color:#E16C3F">C3(Inh_PVALB)</span>']}},498:function(e,t,s){"use strict";s.r(t),s.d(t,{default:function(){return m}});var a=function(){var e=this,t=e._self._c;return t("div",{staticClass:"custom-body-container"},[t("div",{staticClass:"wrap"},[t("HeaderParams",{on:{submitParams:e.submitParams}}),t("div",{staticClass:"canvas-container"},[t("div",{staticClass:"params-container"},[t("span",{staticClass:"params-text"},[e._v("Cell Proportion")]),t("div",{staticClass:"left-scatter canvas-h"},[t("div",{ref:"pieChartContainer",attrs:{id:"pieChartContainer"}})])]),t("div",{staticClass:"params-container"},[t("span",{staticClass:"params-text"}),t("div",{staticClass:"right-scatter canvas-h"},[t("div",{ref:"barChartContainer",attrs:{id:"barChartContainer"}})])])]),t("div",{staticClass:"canvas-container"},[t("div",{staticClass:"box-container",staticStyle:{width:"100%","margin-bottom":"10px"}},[t("div",{staticStyle:{"margin-bottom":"10px"}},[t("span",{staticClass:"params-text"},[e._v("Features")]),t("el-select",{ref:"geneSelect",staticClass:"select-space",attrs:{loading:e.loading,clearable:"",filterable:"",placeholder:"please select gene","filter-method":e.filterValue},on:{change:function(t){return e.switchUmapGene(e.geneFeatures)}},model:{value:e.geneFeatures,callback:function(t){e.geneFeatures=t},expression:"geneFeatures"}},e._l(e.sliceGeneOptions,(function(e){return t("el-option",{key:e["value"],attrs:{label:e["label"],value:e["value"]}})})),1)],1),t("div",{staticClass:"box-chart box-canvas-h"},[t("div",{ref:"expBoxPlot",attrs:{id:"boxChartContainer"}})])])])],1)])},n=[],l=(s(8937),s(8307)),i=s(6361),o=s.n(i),r=s(2585),c=(s(7996),s(8416)),p=s.n(c),h={name:"Exploration",components:{HeaderParams:l.A},data(){return{geneFeatures:"MAP2",datasetParams:{atlas:"Adult",region:"all"},geneOptions:[],sliceGeneOptions:[],filterOptions:[],loading:!1,noMore:!1}},watch:{datasetParams:{handler(e){"Mouse"===this.datasetParams.atlas?this.geneFeatures="Map2":this.geneFeatures="MAP2"}}},methods:{filterValue(e){if(""!==e){let t=this.geneOptions.filter((t=>t.value.toLowerCase().indexOf(e.toLowerCase())>-1)),s=t.slice(0,20);this.$set(this,"sliceGeneOptions",s)}else this.sliceGeneOptions=[]},async loadMore(){if(this.loading)return;this.loading=!0;let e=this.geneOptions.slice(this.sliceGeneOptions.length,this.sliceGeneOptions.length+4);this.sliceGeneOptions=this.sliceGeneOptions.concat(e),this.timer=setTimeout((()=>{this.loading=!1}),500),this.geneOptions.length===this.sliceGeneOptions.length&&(this.$refs.geneSelect.$refs.scrollbar.$refs.wrap.removeEventListener("scroll",this.scolling()),this.noMore=!0)},scolling(){let e=this.$refs.geneSelect.$refs.scrollbar.$refs.wrap;if(this.noMore)return;let t=e.scrollHeight-e.scrollTop-5<e.clientHeight;t&&this.loadMore()},drawHeatMapData(e,t){let s={title:"human & mouse",margin:{l:130,b:115},xaxis:{tickmode:"array",tickangle:-60,zeroline:!1,autotick:!1}},a={toImageButtonOptions:{format:"svg",filename:"image",scale:1}},n=_.cloneDeep(s);n["xaxis"]["ticktext"]=t,n["xaxis"]["tickvals"]=e[0]["x"],o().newPlot(this.$refs.heatmapChartRef,e,n,a)},async groupCellType(e,t){let s=t.reduce(((t,s,a)=>{let n=e[a];return t[n]||(t[n]=[]),t[n].push(s),t}),{});await this.getGeneBoxplot(s)},async getGeneBoxplot(e){const t=document.getElementsByClassName("box-chart");let s=[];for(const n in e)s.push({type:"box",name:n,y:e[n]});const a={height:400,margin:{t:30,b:140},autosize:!0};o().newPlot("boxChartContainer",s,a),window.addEventListener("resize",(()=>{const e=t[0].offsetWidth,s=t[0].offsetHeight;o().relayout("boxChartContainer",{width:e,height:s})}))},async switchUmapGene(e){await this.getLoadData(this.datasetParams,e)},async submitParams(e){this.$set(this,"datasetParams",e),await this.getLoadData(e,this.geneFeatures)},drawPieAndBarChart(e,t){const s=document.getElementsByClassName("left-scatter"),a=document.getElementsByClassName("right-scatter");let n={toImageButtonOptions:{format:"svg",filename:"image",scale:1}},l={width:s[0].offsetWidth,height:s[0].offsetHeight,margin:{t:80,b:100},title:{text:`${this.datasetParams["atlas"]} ${this.datasetParams["region"]}`,font:{size:16},position:"top center"},uniformtext:{minsize:10,mode:"hide"},legend:{traceorder:"reversed",itemclick:!1,itemdoubleclick:!1,x:1,y:1,font:{size:10}}},i={width:a[0].offsetWidth,height:a[0].offsetHeight,legend:{itemclick:!1,itemdoubleclick:!1},xaxis:{title:"celltype",titlefont:{size:20},tickfont:{size:10},tickangle:30},yaxis:{title:"cell number",titlefont:{size:20},tickfont:{size:10}},barmode:"stack",margin:{t:30,b:150}};o().newPlot(this.$refs.pieChartContainer,e,l,n),o().newPlot(this.$refs.barChartContainer,t,i,n),window.addEventListener("resize",(()=>{const e=s[0].offsetWidth,t=s[0].offsetHeight;o().relayout("pieChartContainer",{width:e,height:t})})),window.addEventListener("resize",(()=>{const e=a[0].offsetWidth,t=a[0].offsetHeight;o().relayout("barChartContainer",{width:e,height:t})}))},async dealChartData(e){let t,s,a=[],n=[],l=[];for(let o=0;o<e.length;o++)a.push(e[o].count),n.push(e[o].cell_type);for(let o=0;o<n.length;o++)t={x:n,y:a,name:`${this.datasetParams["atlas"]}_${this.datasetParams["region"]}`,type:"bar",width:.6,marker:{color:r.chartColor}};l.push(t);let i=[r.chartColor,[]];s=[{values:a,labels:n,type:"pie",insidetextorientation:"radial",textposition:"inside",marker:{colors:i[0]},domain:{row:0,column:0},hoverinfo:"label+percent",textinfo:"percent"}],await this.drawPieAndBarChart(s,l)},async getLoadData(e,t){const s=await p().get(`${apiBaseUrl}/json/pie/${e["atlas"]}_${e["region"]}.json`);console.log(366,`/json/pie/${e["atlas"]}_${e["region"]}.json`);let a=s.data;await this.dealChartData(a);let n=await p().get(`${apiBaseUrl}/json/${e["atlas"]}_${e["region"]}_umap.json`);console.log(373,`/json/${e["atlas"]}_${e["region"]}_umap.json`);let l=n.data;if(t){n=await p().get(`${apiBaseUrl}/json/gene/${e["atlas"]}/${e["region"]}/${t}.json`);let s=n.data,a=[];for(let e=0;e<l.length;e++)a.push(l[e]["cell_type"]);let i=s.exps.split(",");await this.groupCellType(a,i)}const i=await p().get(`${apiBaseUrl}/json/geneIndex/${e["atlas"]}.json`);console.log(395,`/json/geneIndex/${e["atlas"]}.json`);let o=i.data;this.sliceGeneOptions=o.slice(0,20),this.$set(this,"geneOptions",o)}},async mounted(){await this.getLoadData(this.datasetParams,this.geneFeatures),this.$refs.geneSelect.$refs.scrollbar.$refs.wrap.addEventListener("scroll",this.scolling)}},u=h,C=s(6367),d=(0,C.A)(u,a,n,!1,null,"4b02e1b1",null),g=d.exports,m=g}}]);